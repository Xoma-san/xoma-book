# Управление репозиториями 

У нас имеется 2 репозитория: локальный (расположенный на нашей рабочей
машине) и удаленный (на сервере).

Есть 2 варианта создания локального репозитория и его связи с сетевым:

-   Создать локальный репозиторий и связать его с сетевым (git init).
    Актуально, если уже начали работу локально;

-   Создать локальную копию существующего сетевого репозитория (git
    clone). Удобно, если локально ничего нет.

## Создание локального + связь с удаленным 

С помощью команды cd перемещаемся в нужную директорию, в которой хотим
организовать хранилище, и, если нужно, создаем каталог (mkdir). В него
можно перенести свои наработки.

Находясь в каталоге, для создания локального репозитория вводим команду
git init.

Далее связываем созданный репозиторий с удаленным репозиторием на
примере tech_doc.

При создании репозитория в нашем ГитЛаб к нему может быть добавлеy
ReadMe-файл, где в разделе Add your files приведены команды, которые
необходимо выполнить, чтобы связать локальный и удаленный репозитории.

Пример команд для tech_doc (в команде git remote add указан адрес
удаленного репозитория)

```cd existing_repo```

```git remote add origin https://gitlab.edigtech.ru/rmi/tech_doc.git```

```git branch -M master```

```git push -uf origin master```

Если хотим сохранить исходный ReadMe-файл, а также использовать не
пустой локальный репозиторий, то необходимо написать следующее:

```cd existing_repo```

```git remote add origin https://gitlab.edigtech.ru/rmi/tech_doc.git```

```git branch -M master```

```git branch \--set-upstream-to=origin/master master```

```git pull -r```

```git push```

Командой  git branch \--set-upstream-to=origin/master master мы связали
локальную мастер-ветку с удаленной. Затем забрали к себе состояние
сетевого репозитория (git pull -r). Далее передали состояние локальной
мастер-ветки в сетевой репозиторий.

## Клонирование удаленного с созданием локального

С помощью команды cd перемещаемся в нужную директорию, в которой хотим
организовать хранилище, и, если нужно, создаем каталог (mkdir).

Находясь в каталоге, для копирования удаленного репозитория с созданием
локального вводим команду git clone [ссылка на удалённый репозиторий].

Например, ссылка на удаленный репозиторий tech_doc выглядит вот
так: <https://github.test.ru/tech_doc.git>.

Такое написание команды создаст в текущей директории папку, одноименную
названию удаленному репозиторию (в случае примера -  tech_doc).

При написании команды можно указать папку, куда нужно создать клон: git
clone [ссылка на удалённый репозиторий] [название папки].

При подобном написании будет кастомное название локального репозитория,
например:

git clone https://github.test.ru/tech_doc.git work-doc

По итогу выполнения команды для удаленного репозитория tech_doc будет
создан связанный локальный репозиторий work-doc.

Вся работа ведется в локальном репозитории. По итогам работы командами
Гита передаем наработки из локального репозитория в удаленный.

Важные правила

-   в мастер нужно пушить осторожно и только тогда, когда это реально
    нужно (что-то важное потеряно и создавать для этого ветку
    бессмысленно);

-   никогда не пушить в мастер с опцией -f (--force). Опция полностью
    перезапишет удаленную ветку локальной;

-   для текущей работы всегда используем ветки (создаем их, когда
    требуется). Мелкие правки пушатся сначала в них. По итогам
    накопления правок и готовности перевыпустить документацию вливаем
    ветку в мастер.

# Работа с Гит 

## Алгоритм работы 

Алгоритм работы с Гитом можно описать общим сценарием "правим
доки-индексируем-коммитим-пушим":

1.  Если мы не знаем, коммитил ли кто-то без нас, то нам необходимо
    подтянуть себе актуальную версию проекта, для этого пишем git pull.

2.  Проверить ветки в проекте, включая удаленный репозиторий:

```git branch -a```

3.  Если не помним, в какой ветке работаем, можем уточнить ее командой

``` git status```

Если ветка неправильная, то переходим в нужную командой

```git checkout NazvanieVetki```

Если нужной никто еще придумал, то создаем ее

```git checkout -b NazvanieVetki```

После этого ведем работу с файлами локального репозитория (создаем, изменяем, удаляем).

4.  Делаем новые или измененные файлы (в которых велась работа) проиндексированными: git add. Данная команда говорит системе: «Вот это пойдет в коммит». Команда может иметь формат:

```git add Nazvanie       /* для файла/папки */```

```git add .                    /* для всего в репозитории */```

6.  Создаем новый коммит (текущую «точку работы»), лучше с комментарием,
    описывающим, что именно было изменено в коммите:

```git commit -m "исправлены ошибки пунктуации в разделе 1.1".    /* локально создали коммит */```

7.  Чтобы наши изменения попали на серверное хранилище мы пишем

```git push    /* коммит попал на сервер */```

## Взаимодействие с Гитом 

У гита для работы есть 3 варианта взаимодействия: CMD, Bash и GUI.

CMD - похож на командную строку Windows. Работает только в нем.

Bash - командная оболочка Linux и MacOS.

GUI - пользовательский графический интерфейс (кнопочки-картиночки).

Мне удобен bash. А так - что удобно, то и можно использовать. Алгоритм
един для всех вариантов отображения.

## Ветки и их использование 

Пример алгоритм приведен для создания комплекта документации по каскадной модели. 
Головная ветка-мастер используется только для хранения выпускаемых комплектов (первичная печать, перепечать листов по
итогам правок).

Для работы над документами необходимо создавать и использовать ветки с
названием, гарантировано дающим понимание, что мы делаем (Опечатки,
НК15-09-24, ВП10-10-24). Вся работа над документами ведется в
маркдаун-файлах для накопления изменений. По итогам внесения правок
формируем промежуточные ворд-документы (можно на каждую правку
.мд-документов, можно только итогово). Формирование ворд-документов для
выпуска (возможно, что без изменений .мд-документов, так как требуется
только верстка) - последний пуш текущей ветки.
После этого ветка вливается в мастер - формируется итоговый на текущий
момент комплект документов.

Веток может быть несколько. И формирование итогового комплекта с
использованием одной из веток не влияет на жизнь других веток.
Например, мы перевыпускаем замечания от Нормоконтролера, но пока не трогаем
замечания ВП. Изменения в ветках могут быть подтянуты в другие ветки
или (если нет конфликтов, которые обрабатываются и подсвечиваются Гитом
и должны быть обработаны вручную) ветка может быть независимо быть влита
в мастер.

Работу над документами маркдауна и ворда можно вести и параллельно.
Индексация-коммит-пуш ворд-документов не обязательно выполняется с
каждым изменением .мд-документов и может выполняться только при
завершении работы с веткой. При этом в коммите обязательно отмечаем, что
запушено, например git commit -m "исправлены ошибки пунктуации в
разделе 1.1. Без верстки docx". git commit -m "исправлены опечатки в
строка 45 и 68. Сверстан docx".   